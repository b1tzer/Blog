# OpenWrt中，旁路由的设置与使用
 
本文的目的，是让您知晓旁路由的概念，并掌握最基础的旁路由设置方法。

## 一、什么是旁路由？
旁路由又叫独臂路由，这一概念由杨过大侠首创（手动狗头）。旁路由一般是由CPU性能比较强的路由器来担当。旁路由的主要责任是帮助网络中的其他设备获取国外网站的数据。

## 二、旁路由的接线方式及工作原理
最基础最常规的旁路由接线方式是这样的


基础的旁路由接线方式
是不是有点挑战常识？主路由的LAN口居然接着旁路由的LAN口？没错，我没画错！

主路由可以是普通的无线路由器。所有联网设备都需要连接主路由。

网络数据在其中会怎样流动呢？


访问国内网站时的数据流动

访问国外网站时的数据流动
上图中，基本展示了旁路由的作用：

分析数据包，判断是否需要加密传输；
加密、解密数据包
三、OpenWrt系统下，旁路由的设置流程
假设主路由的IP地址为192.168.1.1，请根据实际情况进行变通哦！

将旁路由的LAN连接到电脑的网口。没有电脑？旁路由不支持无线？试试这样？使用额外的无线路由器连接到旁路由，再使用手机等无线设备连接无线路由器，进而设置旁路由

旁路由不支持无线时，无线设备设置方法
1. 进入旁路由的管理界面。我们需要修改OpenWrt的LAN口的接口设置


【网络】-【接口】-【LAN编辑】

在【物理设置】中，需要取消勾选【桥接接口】的选项，然后选择到您的LAN硬件接口


设置好之后，请记得点击【保存】。这里划重点，不要点击【保存&应用】！不要点击【保存&应用】！不要点击【保存&应用】！不要点击【保存&应用】！不要点击【保存&应用】！不要点击【保存&应用】！不要点击【保存&应用】！不要点击【保存&应用】！

接下来还需要修改旁路由的防火墙设置

进入【网络】-【防火墙】-【自定义规则】，在最后添加以下代码

iptables -t nat -I POSTROUTING -j MASQUERADE
然后点击【重启防火墙】


防火墙中，添加自定义规则
这样，就完成了旁路由部分的设置。

现在我们要保存应用设置。

在网页的右上角，有【未保存的设置】，点击它


【未保存的设置】按钮
点击【保存&应用】，保存修改。


在【未保存的设置】页面【保存&amp;amp;amp;amp;amp;amp;amp;应用】
至此，旁路由的设置告一段落。

3. 电脑（或手机）连接主路由的LAN口或无线信号。进入主路由的管理界面

4. 关闭主路由的DHCP服务


TP-LINK/水星/迅捷的DHCP设置

华硕/梅林的DHCP设置

OpenWrt主路由的DHCP设置
5. 设置完成。

四、连线，并重新连接网络设备
将主路由和旁路由使用网线进行连接


基础的旁路由接线方式
接线接好之后，请务必将连接主路由的网络设备断开连接后，重新连接主路由的网络。这样，才能完全实现旁路由的设置。

五、一些问题
Q：什么情况下比较建议使用旁路由呢？
A：一般存在以下几种情况：
1）网络结构不想更改，或无法更改
2）主路由有一些旁路由无法实现的功能，如流控等功能
3）就是想做旁路由，不需要理由
Q：我是光猫拨号，后面直接AC和AP的，没有图上的主路由。但是我也想用旁路由。怎么办？
A：把光猫想象成主路由就可以了。
Q：我用的是R1/R1S，LAN接口速率没有WAN接口高，做旁路由时可以用WAN接口吗？
A：可以的。详细可看（还没写的）另一篇文章。
Q：评论里面大家都说照你的教程设置失败了。到底能不能行啊？
A：经过一番检查，我发现图中漏写了一步，就是LAN取消桥接后，必须在接口中选择LAN的物理接口。而大多数小伙伴都是死在了这一步上面。请大家注意哦！